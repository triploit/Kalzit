# This script is only ever used in html/files/buildForBrowser.sh, which itself is only used in html/files/build.sh

$platform = appParameter: "platform".
$rootFolder = appParameter: "kalzit-root-folder".

$coreLanguageFile = "/core/files/_min.js".
$relativeScriptPaths = coreLanguageFile ; `joined list` ;/
	("/" + platform + "/files/" + first each "[^\s]+" allMatches fileContent: rootFolder + "/" + platform + "/bootstrap/packageManagerScripts.txt");
	("/" + platform + "/files/" + first each "[^\s]+" allMatches fileContent: rootFolder + "/" + platform + "/bootstrap/platformScripts.txt").

$generateScript = $path fun {
	runCommand "./cli command terser --mangle keep_fnames " + path
}.

$topScript = (";" strJoin fileContent each rootFolder + relativeScriptPaths).


# Output HTML with a placeholder $scriptTags$ - will be replaced later in the build process

fileCreateFolder: (!getUnixUserFolder) + "/.kalzit/generated".
((!getUnixUserFolder) + "/.kalzit/generated/scriptTagListingTempFile.js") fileWrite topScript.
print: "<script>" + (generateScript: (!getUnixUserFolder) + "/.kalzit/generated/scriptTagListingTempFile.js") + "</script>$scriptTags$"
